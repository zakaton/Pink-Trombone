!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e),window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext.prototype.createNoise=function(){for(var t=this.createBufferSource(),e=this.createBuffer(1,Math.pow(2,12),this.sampleRate),n=e.getChannelData(0),i=0;i<n.length;i++)n[i]=2*Math.random(0)-1;return t.buffer=e,t.loop=!0,t};var i=[{name:"noise",defaultValue:0,minValue:-1,maxValue:1},{name:"frequency",defaultValue:140,minValue:0},{name:"tenseness",defaultValue:.6,minValue:0,maxValue:1},{name:"intensity",defaultValue:1,minValue:0,maxValue:1},{name:"loudness",defaultValue:1,minValue:0,maxValue:1},{name:"tongueIndex",defaultValue:12.9},{name:"tongueDiameter",defaultValue:2.43},{name:"vibratoWobble",defaultValue:1,minValue:0,maxValue:1},{name:"vibratoFrequency",defaultValue:6,minValue:0},{name:"vibratoGain",defaultValue:.005,minValue:0}];i.numberOfConstrictions=3;for(var r=0;r<i.numberOfConstrictions;r++){var o=[{name:"constriction"+r+"index",defaultValue:0,automationRate:"k-rate"},{name:"constriction"+r+"diameter",defaultValue:0,automationRate:"k-rate"}];i.push.apply(i,o)}var s=i;function a(t,e,n){return(a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&c(r,n.prototype),r}).apply(null,arguments)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function l(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x=t,this.y=e,this.z=n}function u(){this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]].map(function(t){return a(l,h(t))}),this.p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this.perm=new Array(Math.pow(2,9)),this.gradP=new Array(Math.pow(2,9)),this.F2=.5*(Math.sqrt(3)-1),this.G2=(3-Math.sqrt(3))/6,this.F3=1/3,this.G3=1/6,this.seed(Date.now())}Object.defineProperties(l.prototype,{dot2:{value:function(t,e){return this.x*t+this.y*e}},dot3:{value:function(t,e,n){return this.dot2(t,e)+this.z*n}}}),Object.defineProperties(u.prototype,{seed:{value:function(t){t>0&&t<1&&(t*=Math.pow(2,16)),(t=Math.floor(t))<Math.pow(2,8)&&(t|=t<<Math.pow(2,3));for(var e=0;e<Math.pow(2,8);e++){var n=1&e?0:Math.pow(2,3),i=this.p[e]^t>>n&Math.pow(2,8)-1;this.perm[e]=this.perm[e+Math.pow(2,8)]=i,this.gradP[e]=this.gradP[e+Math.pow(2,8)]=this.grad3[i%this.grad3.length]}}},simplex2:{value:function(t,e){var n=(t+e)*this.F2,i=Math.floor(t+n),r=Math.floor(e+n),o=(i+r)*this.G2,s=t-i+o,a=e-r+o,c=s>a?1:0,h=1-c,l=s-c+this.G2,u=a-h+this.G2,f=s-1+2*this.G2,d=a-1+2*this.G2;i&=Math.pow(2,8)-1,r&=Math.pow(2,8)-1;var p=this.gradP[i+this.perm[r]],_=this.gradP[i+c+this.perm[r+h]],m=this.gradP[i+1+this.perm[r+1]],v=.5-Math.pow(s,2)-Math.pow(a,2),g=v<0?0:Math.pow(v,4)*p.dot2(s,a),y=.5-Math.pow(l,2)-Math.pow(u,2),b=y<0?0:Math.pow(y,4)*_.dot2(l,u),x=.5-Math.pow(f,2)-Math.pow(d,2);return 70*(g+b+(x<0?0:Math.pow(x,4)*m.dot2(f,d)))}},simplex1:{value:function(t){return this.simplex2(1.2*t,-.7*t)}}});var f=u;function d(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}Math.clamp=function(t,e,n){return t<=e?e:t<n?t:n};var p=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.noise=new f,this.coefficients={alpha:0,Delta:0,E0:0,epsilon:0,omega:0,shift:0,Te:0},this.startSeconds=0}var e,n,i;return e=t,(n=[{key:"process",value:function(t,e,n,i){var r=t.intensity,o=t.loudness,s=0;if(s+=t.vibratoGain*Math.sin(2*Math.PI*i*t.vibratoFrequency),s+=.02*this.noise.simplex1(4.07*i),s+=.04*this.noise.simplex1(2.15*i),t.vibratoWobble>0){var a=0;a+=.2*this.noise.simplex1(.98*i),s+=(a+=.4*this.noise.simplex1(.5*i))*t.vibratoWobble}var c=t.frequency;c*=1+s;var h=t.tenseness;h+=.1*this.noise.simplex1(.46*i),h+=.05*this.noise.simplex1(.36*i),h+=(3-h)*(1-r);var l=1/c,u=i-this.startSeconds,f=u/l;f>=1&&(this.startSeconds=i+u%l,f=this.startSeconds/l,this._updateCoefficients(h));var d=0,p=this._getNoiseModulator(f);p+=3*(1-h*r),t.noiseModulator=p;var _=t.noise;_*=p,_*=h,_*=r,_*=r,_*=1-Math.sqrt(Math.max(h,0)),_*=.02*this.noise.simplex1(1.99*i)+.2;var m=this._getNormalizedWaveform(f);return m*=r,d=_+(m*=o),d*=r}},{key:"update",value:function(){}},{key:"_updateCoefficients",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e={};e.d=Math.clamp(3*(1-t),.5,2.7),e.a=.048*e.d-.01,e.k=.224+.118*e.d,e.g=e.k/4*(.5+1.2*e.k)/(.11*e.d-e.a*(.5+1.2*e.k));var n={};n.a=e.a,n.p=1/(2*e.g),n.e=n.p+n.p*e.k,this.coefficients.epsilon=1/n.a,this.coefficients.shift=Math.exp(-this.coefficients.epsilon*(1-n.e)),this.coefficients.Delta=1-this.coefficients.shift;var i={};i.RHS=(1/this.coefficients.epsilon*(this.coefficients.shift-1)+(1-n.e)*this.coefficients.shift)/this.coefficients.Delta,i.total={},i.total.lower=-(n.e-n.p)/2+i.RHS,i.total.upper=-i.total.lower,this.coefficients.omega=Math.PI/n.p;var r=Math.sin(this.coefficients.omega*n.e),o=-Math.PI*r*i.total.upper/(2*n.p),s=Math.log(o);this.coefficients.alpha=s/(n.p/2-n.e),this.coefficients.E0=-1/(r*Math.exp(this.coefficients.alpha*n.e)),this.coefficients.Te=n.e}},{key:"_getNormalizedWaveform",value:function(t){return t>this.coefficients.Te?(-Math.exp(-this.coefficients.epsilon*(t-this.coefficients.Te))+this.coefficients.shift)/this.coefficients.Delta:this.coefficients.E0*Math.exp(this.coefficients.alpha*t)*Math.sin(this.coefficients.omega*t)}},{key:"_getNoiseModulator",value:function(t){var e=2*Math.PI*t,n=Math.sin(e);return.2*Math.max(0,n)+.1}}])&&d(e.prototype,n),i&&d(e,i),t}();var _=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.length=Math.floor(28*e.length/44),this.start=e.length-this.length+1,this.output=0,this.fade=1,this.offset=.8,this.left=new Float64Array(this.length),this.left.junction=new Float64Array(this.length+1),this.right=new Float64Array(this.length),this.right.junction=new Float64Array(this.length+1),this.reflection=new Float64Array(this.length+1),this.reflection.value=0,this.reflection.new=0,this.diameter=new Float64Array(this.length),this.amplitude=new Float64Array(this.length),this.amplitude.max=new Float64Array(this.length);for(var n=0;n<this.length;n++){var i=n/this.length,r=i<.5?.4+2*i*1.6:.5+1.5*(2-2*i);this.diameter[n]=Math.min(r,1.9)}this.diameter[0]=e.velum.target;for(var o=0;o<this.length;o++)this.amplitude[o]=Math.pow(this.diameter[o],2),o>0&&(this.reflection[o]=(this.amplitude[o-1]-this.amplitude[o])/(this.amplitude[o-1]+this.amplitude[o]))};function m(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var v=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.position=e,this.startTime=n,this.timeAlive=0,this.lifetime=.2,this.strength=.3,this.exponent=200}var e,n,i;return e=t,(n=[{key:"update",value:function(t){this.timeAlive=t-this.startTime}},{key:"amplitude",get:function(){return this.strength*Math.pow(-2,this.timeAlive*this.exponent)}},{key:"isAlive",get:function(){return this.timeAlive<this.lifetime}}])&&m(e.prototype,n),i&&m(e,i),t}();function g(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}Math.interpolate=function(t,e,n){return e*(1-t)+n*t},Math.clamp=function(t,e,n){return t<=e?e:t<n?t:n};var y=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:44;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.length=e,this.blade={start:Math.floor(10*this.length/44)},this.tip={start:Math.floor(32*this.length/44)},this.lip={start:Math.floor(39*this.length/44),reflection:-.85},this.glottis={reflection:.75},this.velum={target:.01},this.grid={offset:1.7},this.tongue={_diameter:2.43,_index:12.9,range:{diameter:{minValue:2.05,maxValue:3.5,get range(){return this.maxValue-this.minValue},get center(){return(this.maxValue+this.minValue)/2},interpolation:function(t){var e=(t-this.minValue)/this.range;return Math.clamp(e,0,1)}},index:{minValue:this.blade.start+2,maxValue:this.tip.start-3,get range(){return this.maxValue-this.minValue},get center(){return(this.maxValue+this.minValue)/2},centerOffset:function(t){return t*this.range/2}}},get diameter(){return this._diameter},set diameter(t){this._diameter=Math.clamp(t,this.range.diameter.minValue,this.range.diameter.maxValue)},get index(){return this._index},set index(t){var e=1-this.range.diameter.interpolation(this.diameter),n=Math.pow(e,.58)-.2*(Math.pow(e,2)-e),i=this.range.index.centerOffset(n);this._index=Math.clamp(t,this.range.index.center-i,this.range.index.center+i)}},this.nose=new _(this),this.transients=[],this.transients.obstruction={last:-1,new:-1},this.previousConstrictions=[],this.previousConstrictions.tongue={},this.right=new Float64Array(this.length),this.right.junction=new Float64Array(this.length+1),this.right.reflection={value:0,new:0},this.left=new Float64Array(this.length),this.left.junction=new Float64Array(this.length+1),this.left.reflection={value:0,new:0},this.reflection=new Float64Array(this.length+1),this.reflection.new=new Float64Array(this.length+1),this.amplitude=new Float64Array(this.length),this.amplitude.max=new Float64Array(this.length),this.diameter=new Float64Array(this.length),this.diameter.rest=new Float64Array(this.length),this.diameter.target=new Float64Array(this.length),this.diameter.new=new Float64Array(this.length);for(var n=0;n<this.length;n++){var i=0;i=n<7*this.length/44-.5?.6:n<12*this.length/44?1.1:1.5,this.diameter[n]=i,this.diameter.rest[n]=i,this.diameter.target[n]=i,this.diameter.new[n]=i}this._updateDiameterRest();for(var r=0;r<this.length;r++)this.diameter[r]=this.diameter.rest[r],this.diameter.target[r]=this.diameter.rest[r];this._updateReflection()}var e,n,i;return e=t,(n=[{key:"process",value:function(t,e,n,i,r){this.tongue.diameter=t.tongueDiameter,this.tongue.index=t.tongueIndex,this._processTransients(i),this._processConstrictions(this.previousConstrictions,t);var o=e/n,s=Math.random()<.1;return this._processLips(t,o,s)}},{key:"_processTransients",value:function(t){for(var e=this.transients.length-1;e>=0;e--){var n=this.transients[e];this.left[n.position]+=n.amplitude,n.update(t),n.isAlive||this.transients.splice(e,1)}}},{key:"_processConstrictions",value:function(t,e){for(var n=0;n<t.length;n++){var i=t[n];if(i.index>=2&&i.index<=this.length&&i.diameter>0){var r=e.glottis;r*=.66*e.noiseModulator,r*=Math.clamp(8*(.7-i.diameter),0,1)*Math.clamp(30*(i.diameter-.3),0,1)/2;var o=Math.floor(i.index),s=r*(i.index-o),a=o+1,c=r*(a-i.index);this.right[o+1]+=s,this.right[a+1]+=c,this.left[o+1]+=s,this.left[a+1]+=c}}}},{key:"_processLips",value:function(t,e,n){this.right.junction[0]=this.left[0]*this.glottis.reflection+t.glottis,this.left.junction[this.length]=this.right[this.length-1]*this.lip.reflection;for(var i=1;i<this.length;i++){var r=Math.interpolate(e,this.reflection[i],this.reflection.new[i])*(this.right[i-1]+this.left[i]);this.right.junction[i]=this.right[i-1]-r,this.left.junction[i]=this.left[i]+r}var o=Math.interpolate(e,this.left.reflection.new,this.left.reflection.value);this.left.junction[this.nose.start]=o*this.right[this.nose.start-1]+(o+1)*(this.nose.left[0]+this.left[this.nose.start]);var s=Math.interpolate(e,this.right.reflection.new,this.right.reflection.value);this.right.junction[this.nose.start]=s*this.left[this.nose.start]+(s+1)*(this.nose.left[0]+this.right[this.nose.start-1]);for(var a=0;a<this.length;a++)if(this.right[a]=.999*this.right.junction[a],this.left[a]=.999*this.left.junction[a+1],n){var c=Math.abs(this.left[a]+this.right[a]);this.amplitude.max[a]=c>this.amplitude.max[a]?c:.999*this.amplitude.max[a]}return this.right[this.length-1]}},{key:"_processNose",value:function(t,e,n){this.nose.left.junction[this.nose.length]=this.nose.right[this.nose.length-1]*this.lip.reflection;var i=Math.interpolate(e,this.nose.reflection.new,this.nose.reflection.value);this.nose.right.junction[0]=i*this.nose.left[0]+(i+1)*(this.left[this.nose.start]+this.right[this.nose.start-1]);for(var r=1;r<this.nose.length;r++){var o=this.nose.reflection[r]*(this.nose.left[r]*this.nose.right[r-1]);this.nose.left.junction[r]=this.nose.left[r]+o,this.nose.right.junction[r]=this.nose.right[r-1]-o}for(var s=0;s<this.nose.length;s++)if(this.nose.left[s]=this.nose.left.junction[s+1]*this.nose.fade,this.nose.right[s]=this.nose.right.junction[s]*this.nose.fade,n){var a=Math.abs(this.nose.left[s]+this.nose.right[s]);this.nose.amplitude.max[s]=a>this.nose.amplitude.max[s]?a:.999*this.nose.amplitude.max[s]}return this.nose.right[this.nose.length-1]}},{key:"update",value:function(t,e){this._updateDiameterRest(),this._updateConstrictions(e),this._updateTract(),this._updateTransients(t),this.nose.diameter[0]=this.velum.target,this.nose.amplitude[0]=Math.pow(this.nose.diameter[0],2),this._updateReflection()}},{key:"_updateDiameterRest",value:function(){for(var t=this.blade.start;t<this.lip.start;t++){var e=(this.tongue.index-t)/(this.tip.start-this.blade.start),n=1.1*Math.PI*e,i=(1.5-(2+(this.tongue.diameter-2)/1.5)+this.grid.offset)*Math.cos(n);t!=this.blade.start-2&&t!=this.lip.start-1||(i*=.8),t!=this.blade.start+0&&t!=this.lip.start-2||(i*=.94);var r=1.5-i;this.diameter.rest[t]=r}}},{key:"_updateConstrictions",value:function(t){var e=!1;e=e||this.tongue.index!==this.previousConstrictions.tongue.index||this.tongue.diameter!==this.previousConstrictions.tongue.diameter;for(var n=Math.max(this.previousConstrictions.length,t.length),i=0,r=t[0],o=this.previousConstrictions[0];!e&&i<n;r=t[++i],o=this.previousConstrictions[i])e=void 0!==r&&void 0!==o?r.index!==o.index||r.diameter!==o.diameter:!(null==r&&null==o);if(e){console.log("update");for(var s=0;s<this.length;s++)this.diameter.target[s]=this.diameter.rest[s];this.velum.target=.01;for(var a=-1;a<t.length;a++){var c=t[a]||this.tongue;if(c.index>this.nose.start&&c.diameter<-this.nose.offset&&(this.velum.target=.4),c.index>=2&&c.index<this.length&&c.diameter>-(.85+this.nose.offset)){var h=c.diameter;if(h-=.3,(h=Math.max(0,h))<3){var l=2;l=c.index<25?10:c.index>=this.tip.start?5:10-5*(c.index-25)/(this.tip.start-25);for(var u=Math.round(c.index),f=Math.ceil(l)+1,d=u-f;d<u+f&&d>=0&&d<this.length;d++){var p,_=Math.abs(d-c.index)-.5;p=_<=0?0:_<=l?.5*(1-Math.cos(Math.PI*_/l)):1;var m=this.diameter.target[d]-h;m>0&&(this.diameter.target[d]=h+m*p)}}}}this.previousConstrictions=t,this.previousConstrictions.tongue={index:this.tongue.index,diameter:this.tongue.diameter}}}},{key:"_updateTract",value:function(){for(var t=0;t<this.length;t++){this.diameter[t]<=0&&(this.transients.obstruction.new=t),t<this.nose.start?.6:t>=this.tip.start?1:.6+.4*(t-this.nose.start),this.diameter[t]=this.diameter.target[t]}}},{key:"_updateTransients",value:function(t){this.nose.amplitude[0]<.05&&(this.transients.obstruction.last>-1&&-1==this.transients.obstruction.new&&this.transients.push(new v(this.transients.obstruction.new,t)),this.transients.obstruction.last=this.transients.obstruction.new)}},{key:"_updateReflection",value:function(){for(var t=0;t<this.length;t++)this.amplitude[t]=Math.pow(this.diameter[t],2),t>0&&(this.reflection[t]=this.reflection.new[t],this.reflection.new[t]=0==this.amplitude[t]?.999:(this.amplitude[t-1]-this.amplitude[t])/(this.amplitude[t-1]+this.amplitude[t]));var e=this.amplitude[this.nose.start]+this.amplitude[this.nose.start+1]+this.nose.amplitude[0];this.left.reflection.value=this.left.reflection.new,this.left.reflection.new=(2*this.amplitude[this.nose.start]-e)/e,this.right.reflection.value=this.right.reflection.new,this.right.reflection.new=(2*this.amplitude[this.nose.start+1]-e)/e,this.nose.reflection.value=this.nose.reflection.new,this.nose.reflection.new=(2*this.nose.amplitude[0]-e)/e}}])&&g(e.prototype,n),i&&g(e,i),t}();function b(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var x=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.glottis=new p,this.tract=new y}var e,n,i;return e=t,(n=[{key:"process",value:function(t,e,n,i,r){var o,s,a=0,c=(o=this.glottis).process.apply(o,arguments);return t.glottis=c,a+=(s=this.tract).process.apply(s,arguments),e=.5,a+=this.tract.process(t,.5,n,i,r),a*=.125}},{key:"update",value:function(t,e){this.glottis.update(),this.tract.update(t,e)}}])&&b(e.prototype,n),i&&b(e,i),t}();function w(t){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function k(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function C(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function M(t){var e="function"==typeof Map?new Map:void 0;return(M=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,i)}function i(){return T(t,arguments,E(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),P(i,t)})(t)}function T(t,e,n){return(T=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&P(r,n.prototype),r}).apply(null,arguments)}function P(t,e){return(P=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function E(t){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function A(t){t._constrictions=[];for(var e=function(e){t._constrictions[e]={_index:e,index:null,diameter:null,_enable:function(){return t._enableConstriction(e)},_disable:function(){return t._disableConstriction(e)},_isEnabled:!1}},n=0;n<s.numberOfConstrictions;n++)e(n);t.newConstriction=function(){return this._constrictions.find(function(t){if(!t._isEnabled)return t._enable(),!0})},t.removeConstriction=function(t){t._disable()},Object.defineProperty(t,"constrictions",{get:function(){return this._constrictions.filter(function(t){return t._isEnabled})}}),t._parameters={},t.tongue=t._parameters.tongue={index:null,diameter:null},t.vibrato=t._parameters.vibrato={frequency:null,gain:null,wobble:null}}function F(t,e,n){if(n.includes("constriction")){var i=Number(n.match(/[0-9]+/g)[0]),r=t._constrictions[i];r[n.includes("index")?"index":"diameter"]=e,t.constrictions[i]=r}else n.includes("vibrato")?t.vibrato[n.replace("vibrato","").toLowerCase()]=e:n.includes("tongue")?t.tongue[n.replace("tongue","").toLowerCase()]=e:t[n]=t._parameters[n]=e}if(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioWorklet){var O=function(t){function e(t){var n,i,r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),i=this,r=E(e).call(this,t,"pink-trombone-worklet-processor"),n=!r||"object"!==w(r)&&"function"!=typeof r?C(i):r,A(C(n)),n.parameters.forEach(function(t,e){F(C(n),t,e)}),n.port.onmessage=function(t){t.data.name},n}var n,i,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&P(t,e)}(e,M(AudioWorkletNode)),n=e,(i=[{key:"_postMessage",value:function(t){var e=this;return t.id=Math.random(),new Promise(function(n,i){e.port.addEventListener("message",function i(r){t.id==Number(r.data.id)&&(e.port.removeEventListener("message",i),n(r))}),e.port.postMessage(t)})}},{key:"_enableConstriction",value:function(t){var e=this;return this._postMessage({name:"enableConstriction",constrictionIndex:t}).then(function(){e._constrictions[t]._isEnabled=!0})}},{key:"_disableConstriction",value:function(t){var e=this;return this._postMessage({name:"disableConstriction",constrictionIndex:t}).then(function(){e._constrictions[t]._isEnabled=!1})}},{key:"getProcessor",value:function(){return this._postMessage({name:"getProcessor"}).then(function(t){return JSON.parse(t.data.processor)})}}])&&k(n.prototype,i),r&&k(n,r),e}();window.AudioContext.prototype.createPinkTromboneNode=function(){return T(O,[this].concat(Array.prototype.slice.call(arguments)))}}else window.AudioContext.prototype.createPinkTromboneNode=function(){var t=this,e=this.createScriptProcessor(Math.pow(2,12),s.length,1);return e.processor=new x,A(e),e.channelMerger=this.createChannelMerger(s.length),e.channelMerger.channels=[],e.channelMerger.connect(e),s.forEach(function(n,i){var r=t.createConstantSource();r.start();var o=r.offset;o.automationRate=n.automationRate||"a-rate",o.value=n.defaultValue||0,r.connect(e.channelMerger,0,i),e.channelMerger.channels[i]=n.name,F(e,o,n.name)}),e._getParameterChannels=function(t){for(var e={},n=0;n<t.numberOfChannels;n++)e[this.channelMerger.channels[n]]=t.getChannelData(n);return e},e._getParameterSamples=function(t,e){for(var n={},i=Object.keys(t),r=0;r<i.length;r++){var o=i[r];o.includes("constriction")||(n[o]=t[o][e])}return n},e._getConstrictions=function(t){for(var e=[],n=0;n<this._constrictions.length;n++){if(this._constrictions[n]._isEnabled){var i={index:t["constriction"+n+"index"][0],diameter:t["constriction"+n+"diameter"][0]};e[n]=i}}return e},e.onaudioprocess=function(t){for(var e=t.outputBuffer.getChannelData(0),n=this._getParameterChannels(t.inputBuffer),i=this._getConstrictions(n),r=0;r<e.length;r++){var o=this._getParameterSamples(n,r),s=e.length,a=t.playbackTime+r/t.inputBuffer.sampleRate;e[r]=this.processor.process(o,r,s,a,i)}this.processor.update(t.playbackTime+e.length/t.inputBuffer.sampleRate,i)},e._enableConstriction=function(t){this._constrictions[t]._isEnabled=!0},e._disableConstriction=function(){this._constrictions[constrictionIndex]._isEnabled=!1},e.getProcessor=function(){var t=this;return new Promise(function(e,n){e(t.processor)})},e};function j(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function S(t,e,n){return e&&j(t.prototype,e),n&&j(t,n),t}window.AudioContext=window.AudioContext||window.webkitAudioContext;var R=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.loadPromise=this.addModules(e).then(function(){return n.audioContext=e,n.setupAudioGraph(),n.audioContext})}return S(t,[{key:"addModules",value:function(t){return void 0!==t.audioWorklet?Promise.all([t.audioWorklet.addModule("/script/audio/nodes/noise/processors/workletProcessors/WorkletProcessor.js"),t.audioWorklet.addModule("/script/audio/nodes/pinkTrombone/processors/workletProcessors/WorkletProcessor.js")]):new Promise(function(t){t()})}}]),S(t,[{key:"setupAudioGraph",value:function(){this._noise=this.audioContext.createNoise(),this._aspirateFilter=this.audioContext.createBiquadFilter(),this._aspirateFilter.type="bandpass",this._aspirateFilter.frequency.value=500,this._aspirateFilter.Q.value=.5,this._fricativeFilter=this.audioContext.createBiquadFilter(),this._fricativeFilter.type="bandpass",this._fricativeFilter.frequency.value=1e3,this._fricativeFilter.Q.value=.5,this._pinkTromboneNode=this.audioContext.createPinkTromboneNode(),this._noise.connect(this._aspirateFilter),this._aspirateFilter.connect(this._pinkTromboneNode.noise),this._noise.connect(this._fricativeFilter),this._fricativeFilter.connect(this._pinkTromboneNode.noise)}},{key:"connect",value:function(){var t;return(t=this._pinkTromboneNode).connect.apply(t,arguments)}},{key:"disconnect",value:function(){var t;return(t=this._pinkTromboneNode).disconnect.apply(t,arguments)}},{key:"start",value:function(){this._noise.start()}},{key:"stop",value:function(){this._noise.stop()}},{key:"newConstriction",value:function(){var t;return(t=this._pinkTromboneNode).newConstriction.apply(t,arguments)}},{key:"removeConstriction",value:function(t){this._pinkTromboneNode.removeConstriction(t)}},{key:"getProcessor",value:function(){return this._pinkTromboneNode.getProcessor()}},{key:"parameters",get:function(){return this._pinkTromboneNode._parameters}},{key:"constrictions",get:function(){return this._pinkTromboneNode.constrictions}}]),t}();window.AudioContext.prototype.createPinkTrombone=function(){return new R(this)};function V(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var I=function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._container=document.createElement("div"),this._canvases={},this._contexts={},["tract","background"].forEach(function(t,n){var i=document.createElement("canvas");i.id=t,i.style.position="absolute",i.style.backgroundColor="transparent",i.style.margin=0,i.style.padding=0,i.style.zIndex=1-n,e._canvases[t]=i,e._contexts[t]=i.getContext("2d"),e._container.appendChild(i)}),this._canvas=this._canvases.tract,this._context=this._contexts.tract,this._tract={origin:{x:340,y:460,_x:340,_y:460,get scale(){return Math.min(this.x/this._x,this.y/this._y)}},radius:298,_radius:298,scale:60,_scale:60,angle:{scale:.64,offset:-.25},resize:function(){e._tract.origin.x=e.width*e._tract.origin._x/600,e._tract.origin.y=e.height*e._tract.origin._y/600;var t=e._tract.origin.scale;e._tract.radius=e._tract._radius*t,e._tract.scale=e._tract._scale*t}},this._processor=null,this._parameters={},this._container.addEventListener("animationFrame",function(t){var n=new CustomEvent("getProcessor",{bubbles:!0});e._container.dispatchEvent(n);var i=new CustomEvent("getParameter",{bubbles:!0,detail:{parameterName:"intensity"}});e._container.dispatchEvent(i)}),this._container.addEventListener("didGetProcessor",function(t){e._processor=t.detail.processor,e._resize(),e._drawTract()}),this._container.addEventListener("didGetParameter",function(t){var n=t.detail.parameterName,i=t.detail.value;e._parameters[n]=i}),new MutationObserver(function(t,n){if(document.contains(e._container)){var i=new CustomEvent("requestAnimationFrame",{bubbles:!0});e._container.dispatchEvent(i),n.disconnect()}}).observe(document.body,{subtree:!0,childList:!0}),this._container.addEventListener("mousedown",function(t){}),this._container.addEventListener("mousemove",function(t){}),this._container.addEventListener("mouseup",function(t){})}var e,n,i;return e=t,(n=[{key:"_resize",value:function(){this._tract.resize(),this._resizeCanvases()}},{key:"_resizeCanvases",value:function(){for(var t in this._canvases)this._canvases[t].width=this._canvases[t].style.width=this._container.offsetWidth,this._canvases[t].height=this._canvases[t].style.height=this._container.offsetHeight}},{key:"_drawTract",value:function(){if(!this._isDrawing){this._isDrawing=!0,this._context=this._contexts.tract,this._context.clearRect(0,0,this._canvas.width,this._canvas.height),this._context.lineCap=this._context.lineJoin="round",this._drawTongueControl(),this._context.beginPath(),this._context.lineWidth=2,this._context.strokeStyle=this._context.fillStyle="pink",this._moveTo(1,0);for(var t=1;t<this._processor.tract.length;t++)this._lineTo(t,this._processor.tract.diameter[t]);for(var e=this._processor.tract.length-1;e>=2;e--)this._lineTo(e,0);this._context.closePath(),this._context.stroke(),this._context.fill();var n=this._processor.tract.nose.diameter[0],i=4*n;this._context.beginPath(),this._context.lineWidth=2,this._context.strokeStyle=this._context.fillStyle="pink",this._moveTo(this._processor.tract.nose.start,-this._processor.tract.nose.offset);for(var r=1;r<this._processor.tract.nose.length;r++)this._lineTo(r+this._processor.tract.nose.start,-this._processor.tract.nose.offset-.9*this._processor.tract.nose.diameter[r]);for(var o=this._processor.tract.nose.length-1;o>=1;o--)this._lineTo(o+this._processor.tract.nose.start,-this._processor.tract.nose.offset);this._context.closePath(),this._context.fill(),this._context.beginPath(),this._context.lineWidth=2,this._context.strokeStyle=this._context.fillStyle="pink",this._moveTo(this._processor.tract.nose.start-2,0),this._lineTo(this._processor.tract.nose.start,-this._processor.tract.nose.offset),this._lineTo(this._processor.tract.nose.start+i,-this._processor.tract.nose.offset),this._lineTo(this._processor.tract.nose.start+i-2,0),this._context.closePath(),this._context.stroke(),this._context.fill(),this._context.fillStyle="white",this._context.font="20px Arial",this._context.textAlign="center",this._context.globalAlpha=1,this._drawText(.1*this._processor.tract.length,.425,"throat",!1),this._drawText(.71*this._processor.tract.length,-1.8,"nasal",!1),this._drawText(.71*this._processor.tract.length,-1.3,"cavity",!1),this._context.font="22px Arial",this._drawText(.6*this._processor.tract.length,.9,"oral",!1),this._drawText(.7*this._processor.tract.length,.9,"cavity",!1),this._drawAmplitudes(),this._context.beginPath(),this._context.lineWidth=5,this._context.strokeStyle="#C070C6",this._context.lineJoin=this._context.lineCap="round",this._moveTo(1,this._processor.tract.diameter[0]);for(var s=2;s<this._processor.tract.length;s++)this._lineTo(s,this._processor.tract.diameter[s]);this._moveTo(1,0);for(var a=2;a<=this._processor.tract.nose.start-2;a++)this._lineTo(a,0);this._moveTo(this._processor.tract.nose.start+i-2,0);for(var c=this._processor.tract.nose.start+Math.ceil(i)-2;c<this._processor.tract.length;c++)this._lineTo(c,0);this._context.stroke(),this._context.beginPath(),this._context.lineWidth=5,this._context.strokeStyle="#C070C6",this._context.lineJoin="round",this._moveTo(this._processor.tract.nose.start,-this._processor.tract.nose.offset);for(var h=1;h<this._processor.tract.nose.length;h++)this._lineTo(h+this._processor.tract.nose.start,-this._processor.tract.nose.offset-.9*this._processor.tract.nose.diameter[h]);this._moveTo(this._processor.tract.nose.start+i,-this._processor.tract.nose.offset);for(var l=Math.ceil(i);l<this._processor.tract.nose.length;l++)this._lineTo(l+this._processor.tract.nose.start,-this._processor.tract.nose.offset);this._context.stroke(),this._context.globalAlpha=5*n,this._context.beginPath(),this._moveTo(this._processor.tract.nose.start-2,0),this._lineTo(this._processor.tract.nose.start,-this._processor.tract.nose.offset),this._lineTo(this._processor.tract.nose.start+i,-this._processor.tract.nose.offset),this._lineTo(this._processor.tract.nose.start+i-2,0),this._context.stroke(),this._context.fillStyle="orchid",this._context.font="20px Arial",this._context.textAlign="center",this._context.globalAlpha=.7,this._drawText(.95*this._processor.tract.length,.8+.8*this._processor.tract.diameter[this._processor.tract.length-1]," lip",!1),this._context.globalAlpha=1,this._context.fillStyle="black",this._context.textAlign="left",this._drawPositions(),this._isDrawing=!1}}},{key:"_drawCircle",value:function(t,e,n){var i=this._getAngle(t),r=this._getRadius(t,e);this._context.beginPath(),this._context.arc(this._getX(i,r),this._getY(i,r),n,0,2*Math.PI),this._context.fill()}},{key:"_drawTongueControl",value:function(){var t=this;this._context.lineCap=this._context.lineJoin="round",this._context.strokeStyle=this._context.fillStyle="#FFEEF5",this._context.globalAlpha=1,this._context.beginPath(),this._context.lineWidth=45,this._moveTo(this._processor.tract.tongue.range.index.minValue,this._processor.tract.tongue.diameter.minValue);for(var e=this._processor.tract.tongue.range.index.minValue+1;e<=this._processor.tract.tongue.range.maxValue;e++)this._lineTo(e,this._processor.tract.tongue.range.diameter.minValue);this._lineTo(this._processor.tract.tongue.range.index.center,this._processor.tract.tongue.range.diameter.maxValue),this._context.closePath(),this._context.stroke(),this._context.fill(),this._context.fillStyle="orchid",this._context.globalAlpha=.3,[0,-4.25,-8.5,4.25,8.5,-6.1,6.1,0,0].forEach(function(e,n){var i=n<5?t._processor.tract.tongue.range.diameter.minValue:n<8?t._processor.tract.tongue.range.diameter.center:t._processor.tract.tongue.range.diameter.maxValue;t._drawCircle(t._processor.tract.tongue.range.index.center+e,i,3)});var n=this._getAngle(this._processor.tract.tongue.index),i=this._getRadius(this._processor.tract.tongue.index,this._processor.tract.tongue.diameter);this._context.lineWidth=4,this._context.strokeStyle="orchid",this._context.globalAlpha=.7,this._context.beginPath(),this._context.arc(this._getX(n,i),this._getY(n,i),18,0,2*Math.PI),this._context.stroke(),this._context.globalAlpha=.15,this._context.fill(),this._context.globalAlpha=1,this._context.fillStyle="orchid"}},{key:"_drawAmplitudes",value:function(){this._context.strokeStyle="orchid",this._context.lineCap="butt",this._context.globalAlpha=.3;for(var t=2;t<this._processor.tract.length-1;t++)this._context.beginPath(),this._context.lineWidth=3*Math.sqrt(this._processor.tract.amplitude.max[t]),this._moveTo(t,0),this._lineTo(t,this._processor.tract.diameter[t]),this._context.stroke();for(var e=1;e<this._processor.tract.nose.length-1;e++)this._context.beginPath(),this._context.lineWidth=3*Math.sqrt(this._processor.tract.nose.amplitude.max[e]),this._moveTo(this._processor.tract.nose.start+e,-this._processor.tract.nose.offset),this._lineTo(this._processor.tract.nose.start+e,-this._processor.tract.nose.offset-.9*this._processor.tract.nose.diameter[e]),this._context.stroke();this._context.globalAlpha=1}},{key:"_drawPositions",value:function(){var t=this;this._context.fillStyle="orchid",this._context.font="24px Arial",this._context.textAlign="center",this._context.globalAlpha=.6,[[15,.6,"æ"],[13,.27,"a"],[12,0,"ɒ"],[17.7,.05,"(ɔ)"],[27,.65,"ɪ"],[27.4,.21,"i"],[20,1,"e"],[18.1,.37,"ʌ"],[23,.1,"(u)"],[21,.6,"ə"]].forEach(function(e){var n=e[0],i=1.5*e[1]+2,r=e[2];t._drawText(n,i,r,!1)}),this._context.globalAlpha=.8;this._drawText(38,1.1,"l",!1),this._drawText(41,1.1,"w",!1),this._drawText(4.5,.37,"h",!1);var e=this._parameters.intensity>0?["ʒ","z","v","g","d","b"]:["ʃ","s","f","k","t","p"];e.push("ŋ","n","m");[31.5,36,41,22,36,41,22,36,41].forEach(function(n,i){var r=i<4?.3:i<6?-.4:-1.1;t._drawText(n,r,e[i],!1)})}},{key:"_drawText",value:function(t,e,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=this._getAngle(t),o=this._getRadius(t,e);this._context.save(),this._context.translate(this._getX(r,o),this._getY(r,o)+2),i||this._context.rotate(r-Math.PI/2),this._context.fillText(n,0,0),this._context.restore()}},{key:"_moveTo",value:function(t,e){this.__to(t,e,!0)}},{key:"_lineTo",value:function(t,e){this.__to(t,e,!1)}},{key:"__to",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=this._getWobble(t),r=this._getAngle(t,e)+i,o=this._getRadius(t,e)+100*i,s=this._getX(r,o),a=this._getY(r,o);n?this._context.moveTo(s,a):this._context.lineTo(s,a)}},{key:"_getX",value:function(t,e){return this._tract.origin.x-e*Math.cos(t)}},{key:"_getY",value:function(t,e){return this._tract.origin.y-e*Math.sin(t)}},{key:"_getAngle",value:function(t){return this._tract.angle.offset+t*this._tract.angle.scale*Math.PI/(this._processor.tract.lip.start-1)}},{key:"_getWobble",value:function(t){var e=this._processor.tract.amplitude.max[this._processor.tract.length-1]+this._processor.tract.nose.amplitude.max[this._processor.tract.nose.length-1];return e*=.03*Math.sin(2*t-Date.now()/1e3*50)*t/this._processor.tract.length}},{key:"_getRadius",value:function(t,e){return this._tract.radius-this._tract.scale*e}},{key:"node",get:function(){return this._container}},{key:"width",get:function(){return this._container.offsetWidth}},{key:"height",get:function(){return this._container.offsetHeight}}])&&V(e.prototype,n),i&&V(e,i),t}();function N(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}Math.clamp=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return t<e?e:t<n?t:n};var L=function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._frequency={min:20,max:1e3,get range(){return this.max-this.min},interpolate:function(t){return this.min+this.range*t}},this._isActive=!1,this._container=document.createElement("div"),this._container.style.border="solid red 1px",this._container.style.backgroundColor="pink",this._container.style.borderRadius="20px",this._slider=document.createElement("div"),this._slider.style.position="relative",this._slider.style.flex=0,this._slider.style.width="20px",this._slider.style.height="20px",this._slider.style.borderRadius="20px",this._slider.style.border="solid red 5px",this._slider.style.top="50%",this._slider.style.left="50%",this._container.appendChild(this._slider),this._container.addEventListener("mousedown",function(t){e._isActive=!0}),this._container.addEventListener("mousemove",function(t){if(e._isActive){var n={vertical:Math.clamp((t.pageY-e._container.offsetTop)/e._container.offsetHeight,0,.99),horizontal:Math.clamp((t.pageX-e._container.offsetLeft)/e._container.offsetWidth,0,.99)},i={frequency:e._frequency.interpolate(n.horizontal),tenseness:1-n.vertical,loudness:1-.8*n.vertical};Object.keys(i).forEach(function(t){var n=new CustomEvent("setParameter",{bubbles:!0,detail:{parameterName:t,newValue:i[t]}});e._container.dispatchEvent(n)})}}),this._container.addEventListener("mouseup",function(t){e._isActive=!1}),new MutationObserver(function(t,n){if(document.contains(e._container)){var i=new CustomEvent("requestAnimationFrame",{bubbles:!0});e._container.dispatchEvent(i),n.disconnect()}}).observe(document.body,{subtree:!0,childList:!0}),this._container.addEventListener("animationFrame",function(t){["frequency","tenseness"].forEach(function(e){var n=new CustomEvent("getParameter",{bubbles:!0,detail:{parameterName:e}});t.target.dispatchEvent(n)})}),this._container.addEventListener("didGetParameter",function(t){var n,i=t.detail.parameterName,r=t.detail.value;["frequency","tenseness"].includes(i)&&("frequency"==i?(n=Math.clamp((r-e._frequency.min)/e._frequency.range),e._slider.style.left=n*e._container.offsetWidth-e._slider.offsetWidth/2):(n=1-Math.clamp(r),e._slider.style.top=n*e._container.offsetHeight-e._slider.offsetHeight/2))})}var e,n,i;return e=t,(n=[{key:"node",get:function(){return this._container}}])&&N(e.prototype,n),i&&N(e,i),t}();function q(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var W=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._container=document.createElement("div"),this._container.style.display="flex",this._container.style.flexDirection="column",this._buttons={wobble:this._createButton("wobble","vibrato.wobble"),voice:this._createButton("voice","intensity")}}var e,n,i;return e=t,(n=[{key:"_createButton",value:function(t,e){var n=document.createElement("button");n.id=t,n.value=!0,n.innerText=t,n.style.width="100%",n.style.flex=1,n.style.margin="2px",n.style.borderRadius="20px",n.style.backgroundColor="pink",n.style.border="solid red",this._container.appendChild(n),n.addEventListener("click",function(i){n.value="false"==n.value;var r=new CustomEvent("setParameter",{bubbles:!0,detail:{parameterName:e||t,newValue:"true"==n.value?1:0}});n.dispatchEvent(r)}),n.addEventListener("didSetParameter",function(t){})}},{key:"node",get:function(){return this._container}}])&&q(e.prototype,n),i&&q(e,i),t}();function D(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var U=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._tractUI=new I,this._glottisUI=new L,this._buttonsUI=new W,this._container=document.createElement("div"),this._container.style.height="100%",this._container.style.width="100%",this._container.style.display="grid",this._container.style.gridTemplateRows="auto 200px 100px",this._container.style.gridTemplateColumns="auto 100px",this._container.style.gridRowGap="5px",this._container.appendChild(this._tractUI.node),this._tractUI.node.id="tractUI",this._tractUI.node.style.gridColumn="1 / span 2",this._tractUI.node.style.gridRow="1 / span 2",this._container.appendChild(this._glottisUI.node),this._glottisUI.node.id="glottisUI",this._glottisUI.node.style.gridColumn="1 / span 2",this._glottisUI.node.style.gridRow="3",this._container.appendChild(this._buttonsUI.node),this._buttonsUI.node.id="buttonsUI",this._buttonsUI.node.style.zIndex=1,this._buttonsUI.node.style.gridColumn="2",this._buttonsUI.node.style.gridRow="2"}var e,n,i;return e=t,(n=[{key:"node",get:function(){return this._container}}])&&D(e.prototype,n),i&&D(e,i),t}();function G(t){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function z(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function B(t,e){return!e||"object"!==G(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function H(t){var e="function"==typeof Map?new Map:void 0;return(H=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,i)}function i(){return X(t,arguments,J(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Y(i,t)})(t)}function X(t,e,n){return(X=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&Y(r,n.prototype),r}).apply(null,arguments)}function Y(t,e){return(Y=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function J(t){return(J=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Q=function(t){function e(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=B(this,J(e).call(this)))._animationFrameObservers=[],window.customElements.whenDefined("pink-trombone").then(function(){t.UI=new U,t.appendChild(t.UI.node),t.addEventListener("requestAnimationFrame",function(e){t._animationFrameObservers.includes(e.target)||t._animationFrameObservers.push(e.target);var n=new CustomEvent("didRequestAnimationFrame");e.target.dispatchEvent(n),e.stopPropagation()}),t.addEventListener("setParameter",function(e){var n=e.detail.parameterName.split(".").reduce(function(t,e){return t[e]},t.parameters),i=Number(e.detail.newValue);n.value=i;var r=new CustomEvent("didSetParameter",{detail:e.detail});e.target.dispatchEvent(r),e.stopPropagation()}),t.addEventListener("getParameter",function(e){var n=e.detail.parameterName,i=n.split(".").reduce(function(t,e){return t[e]},t.parameters).value,r=new CustomEvent("didGetParameter",{detail:{parameterName:n,value:i}});e.target.dispatchEvent(r),e.stopPropagation()}),t.addEventListener("newConstriction",function(e){var n=t.newConstriction(),i=new CustomEvent("didNewConstriction",{detail:{constrictionIndex:n._index}});e.target.dispatchEvent(i),e.stopPropagation()}),t.addEventListener("setConstriction",function(e){var n=Number(e.detail.constrictionIndex),i=t.constrictions[n],r=e.detail,o=r.index,s=r.diameter;o&&(i.index.value=Number(o)),s&&(i.diameter.value=Number(o));var a=new CustomEvent("didSetConstriction");t.target.dispatchEvent(a),e.stopPropagation()}),t.addEventListener("getConstriction",function(e){var n=Number(e.detail.constrictionIndex),i=t.constrictions[n],r=new CustomEvent("didGetConstriction",{detail:{index:i.index.value,diameter:i.diameter.value}});t.target.dispatchEvent(r),e.stopPropagation()}),t.addEventListener("removeConstriction",function(e){var n=Number(e.detail.constrictionIndex),i=t.constrictions[n];t.removeConstriction(i);var r=new CustomEvent("didRemoveConstriction");t.target.dispatchEvent(r),e.stopPropagation()}),t.addEventListener("getProcessor",function(e){t.getProcessor().then(function(t){var n=new CustomEvent("didGetProcessor",{detail:{processor:t}});e.target.dispatchEvent(n)}),e.stopPropagation()})});var n=new Event("load");return t.dispatchEvent(n),t}var n,i,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Y(t,e)}(e,H(HTMLElement)),n=e,r=[{key:"observedAttributes",get:function(){return[]}}],(i=[{key:"attributeChangedCallback",value:function(t,e,n){t}},{key:"setAudioContext",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new window.AudioContext;return this.pinkTrombone=e.createPinkTrombone(),this.loadPromise=this.pinkTrombone.loadPromise.then(function(e){return t.parameters=t.pinkTrombone.parameters,t.pinkTrombone}),this.loadPromise}},{key:"connect",value:function(){var t;if(this.pinkTrombone)return(t=this.pinkTrombone).connect.apply(t,arguments)}},{key:"disconnect",value:function(){var t;if(this.pinkTrombone)return(t=this.pinkTrombone).disconnect.apply(t,arguments)}},{key:"start",value:function(){var t=this;if(this.pinkTrombone)return this.isRunning=!0,window.requestAnimationFrame(function(e){t._requestAnimationFrameCallback(e)}),this.pinkTrombone.start();throw"Pink Trombone hasn't been set yet"}},{key:"stop",value:function(){if(this.pinkTrombone)return this.isRunning=!1,this.pinkTrombone.stop();throw"Pink Trombone hasn't been set yet"}},{key:"_requestAnimationFrameCallback",value:function(t){var e=this;this.isRunning&&(this._animationFrameObservers.forEach(function(e){var n=new CustomEvent("animationFrame",{detail:{highResTimeStamp:t}});e.dispatchEvent(n)}),window.requestAnimationFrame(function(t){return e._requestAnimationFrameCallback.call(e,t)}))}},{key:"newConstriction",value:function(){var t;return(t=this.pinkTrombone).newConstriction.apply(t,arguments)}},{key:"removeConstriction",value:function(t){return this.pinkTrombone.removeConstriction(t)}},{key:"getProcessor",value:function(){return this.pinkTrombone.getProcessor()}},{key:"audioContext",get:function(){if(this.pinkTrombone)return this.pinkTrombone.audioContext;throw"Audio Context has not been set"},set:function(t){this.setAudioContext(t)}},{key:"constrictions",get:function(){return this.pinkTrombone.constrictions}}])&&z(n.prototype,i),r&&z(n,r),e}();document.createElement("pink-trombone").constructor==HTMLElement&&window.customElements.define("pink-trombone",Q);e.default=Q}]);